# ┌────────────────────────────────────────────────────────────┐
# │ KlipperLab — Klipper Firmware Build and Test Environment   │
# │ Author: Yurii (https://github.com/memfis99999)             │
# │ License: GNU GPLv3                                         │
# │ Project started: 2025                                      │
# └────────────────────────────────────────────────────────────┘

server {
    listen 80;
    server_name localhost;

    # Redirect root requests to Fluidd
    location = / {
        return 302 /fluidd/;
    }

    ### Fluidd static assets ###
    # Serve JS, CSS, and other static files
    location /fluidd/assets/ {
        alias /var/www/fluidd/assets/;
        access_log off;
        expires 30d;
        try_files $uri =404;
        default_type application/javascript;  # Fallback if Nginx fails to detect type
    }

    # Fluidd SPA main handler
    location /fluidd/ {
        alias /var/www/fluidd/;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    ### Mainsail (uncomment to enable) ###
    # location /mainsail/ {
    #     alias /mainsail/;
    #     index index.html;
    #     try_files $uri $uri/ /index.html;
    # }

    ### Moonraker API proxy ###
    location /moonraker/ {
        proxy_pass http://localhost:7125/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }
}
